<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Turntable Controller &mdash; Pete&#39;s Pages  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/peteGSX-theme.css" type="text/css" />
    <link rel="canonical" href="https://petegsx-projects.github.io/rotary-encoder/turntable-controller.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Device Driver and EX-RAIL Integration" href="ex-rail-integration.html" />
    <link rel="prev" title="Control Knob Mode" href="control-knob.html" />   
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="Pete's Pages Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Pete's Pages
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">DCC-EX Rotary Encoder</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="control-knob.html">Control Knob Mode</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Turntable Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="ex-rail-integration.html">Device Driver and EX-RAIL Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../turntable-controller/index.html">Programmable DCC Turntable Controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../turntable-controller/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turntable-controller/hardware.html">Hardware components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turntable-controller/software.html">Software and Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turntable-controller/programming.html">Programming</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rokuhan-turnout-control/index.html">Rokuhan DCC Turnout Controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rokuhan-turnout-control/overview.html">Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../serial-throttle/index.html">Mimic panel serial throttle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth-programmer/index.html">HC-05/06 Bluetooth Programmer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manage-github-labels/index.html">Managing GitHub labels with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">How to contact me</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blog/index.html">Pete’s Pages Blog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pete's Pages</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="overview.html">DCC-EX Rotary Encoder</a></li>
      <li class="breadcrumb-item active">Turntable Controller</li>
  
    
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/peteGSX-Projects/petegsx-projects.github.io/blob/sphinx/docs/rotary-encoder/turntable-controller.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  

  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="control-knob.html" class="btn btn-neutral float-left" title="Control Knob Mode" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ex-rail-integration.html" class="btn btn-neutral float-right" title="Device Driver and EX-RAIL Integration" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
              <section id="turntable-controller">
<h1>Turntable Controller<a class="headerlink" href="#turntable-controller" title="Permalink to this heading"></a></h1>
<aside class="sidebar">
<nav class="contents local" id="on-this-page">
<p class="topic-title">On this page</p>
<ul class="simple">
<li><p><a class="reference internal" href="#hardware-details" id="id1">Hardware details</a></p></li>
<li><p><a class="reference internal" href="#configuration-options" id="id2">Configuration options</a></p>
<ul>
<li><p><a class="reference internal" href="#turntable-mode-configuration-options" id="id3">Turntable mode configuration options</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-the-predefined-positions" id="id4">Configuring the predefined positions</a></p></li>
<li><p><a class="reference internal" href="#configuring-colours" id="id5">Configuring colours</a></p></li>
</ul>
</nav>
</aside>
<p>In turntable controller mode, a GC9A01 round LCD displays a representative turntable with each pre-defined position indicated around a representative turntable pit.</p>
<p>Rotating the rotary encoder will rotate the representative turntable in either a clockwise or anti-clockwise direction.</p>
<p>When the representative turntable’s home end aligns with either the home position or any of the predefined turntable positions, the textual description of the position will be displayed, and the home end of the representative turntable will be highlighted.</p>
<p>When aligned in this manner, a single button press will send the predefined position’s ID to the EX-CommandStation.</p>
<p>The device driver also has the ability to send feedback to the rotary encoder software to indicate when a turntable is moving or stationary. This allows for a visual indication of when the turntable is in motion by blinking the representative turntable on the display until the move has completed.</p>
<p>Refer to</p>
<p>Clicking on the image below will take you to a short video of this mode in action.</p>
<a class="reference external image-reference" href="https://youtu.be/ZWiGnvN81XI"><img alt="Rotary Encoder - Turntable Mode" src="../_images/turntable-controller.jpg" style="width: 384.0px; height: 216.0px;" /></a>
<section id="hardware-details">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Hardware details</a><a class="headerlink" href="#hardware-details" title="Permalink to this heading"></a></h2>
<a class="reference internal image-reference" href="../_images/rotary-encoder-gc9a01.png"><img alt="Rotary Encoder Fritzing" src="../_images/rotary-encoder-gc9a01.png" style="width: 998.1px; height: 427.5px;" /></a>
<p>A suitable rotary encoder (tested on KY-040) and GC9A01 round LCD connected to a suitable AVR based Arduino (tested on a Nano) is all required for the turntable controller functionality, with the Arduino connected to your EX-CommandStation via I2C as outlined in the Fritzing diagram.</p>
<p>The GC9A01 display in use is a <a class="reference external" href="https://www.waveshare.com/1.28inch-LCD-Module.htm">Waveshare</a> brand display.</p>
<p>There is a fairly detailed <a class="reference external" href="https://www.waveshare.com/wiki/1.28inch_LCD_Module">Waveshare Wiki</a> for this device also.</p>
</section>
<section id="configuration-options">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Configuration options</a><a class="headerlink" href="#configuration-options" title="Permalink to this heading"></a></h2>
<p>Various configuration options can be edited in the file “config.h”. By default, this file does not exist, and an example file “config.example.h” with the various options has been provided. It is recommended to copy the example file to your own “config.h”, as the example file will be overwritten by any future changes to the software.</p>
<p>For general configuration options, refer to <a class="reference internal" href="overview.html#general-configuration-options"><span class="std std-ref">General configuration options</span></a>.</p>
<section id="turntable-mode-configuration-options">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Turntable mode configuration options</a><a class="headerlink" href="#turntable-mode-configuration-options" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Details and options</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GC9A01_DIN</p></td>
<td><p>11</p></td>
<td><p>GC9A01 DIN pin</p></td>
</tr>
<tr class="row-odd"><td><p>GC9A01_CLK</p></td>
<td><p>13</p></td>
<td><p>GC9A01 CLK/clock pin</p></td>
</tr>
<tr class="row-even"><td><p>GC9A01_CS</p></td>
<td><p>10</p></td>
<td><p>GC9A01 CS/chip select pin</p></td>
</tr>
<tr class="row-odd"><td><p>GC9A01_DC</p></td>
<td><p>7</p></td>
<td><p>GC9A01 DC pin</p></td>
</tr>
<tr class="row-even"><td><p>GC9A01_RST</p></td>
<td><p>8</p></td>
<td><p>GC9A01 RST/reset pin</p></td>
</tr>
<tr class="row-odd"><td><p>GC9A01_BL</p></td>
<td><p>9</p></td>
<td><p>GC9A01 BL/backlight pin</p></td>
</tr>
<tr class="row-even"><td><p>GC9A01_ROTATION</p></td>
<td><p>0</p></td>
<td><p>Rotates the display, set to 0 for none, 1 for 90 degrees, 2 for 180 degrees, and 3 for 270 degrees</p></td>
</tr>
<tr class="row-odd"><td><p>GC9A01_IPS</p></td>
<td><p>true</p></td>
<td><p>Set “true” to correctly display colours, only change if using a different display as per the GFX library</p></td>
</tr>
<tr class="row-even"><td><p>PIT_OFFSET</p></td>
<td><p>30</p></td>
<td><p>Number of pixels to inset the representative turntable pit</p></td>
</tr>
</tbody>
</table>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//  START: TURNTABLE mode configuration options.</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="cp">#define GC9A01_DIN 11     </span><span class="c1">// Define GC9A01 DIN pin</span>
<span class="cp">#define GC9A01_CLK 13     </span><span class="c1">// Define GC9A01 CLK/clock pin</span>
<span class="cp">#define GC9A01_CS 10      </span><span class="c1">// Define GC9A01 CS/chip select pin</span>
<span class="cp">#define GC9A01_DC 7       </span><span class="c1">// Define GC9A01 DC pin</span>
<span class="cp">#define GC9A01_RST 8      </span><span class="c1">// Define GC9A01 RST/reset pin</span>
<span class="cp">#define GC9A01_BL 9       </span><span class="c1">// Define GC9A01 BL/backlight pin</span>
<span class="c1">// Rotation can be 0, 1 (90 degrees), 2 (180 degrees), or 3 (270 degrees)</span>
<span class="c1">// Rotates entire display</span>
<span class="cp">#define GC9A01_ROTATION 0</span>
<span class="c1">// Needs to be set true in order to correctly display colours</span>
<span class="cp">#define GC9A01_IPS true</span>
<span class="c1">//  Number of pixels to inset the representation of the turntable pit.</span>
<span class="cp">#define PIT_OFFSET 30</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//  END: TURNTABLE mode configuration options.</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
</pre></div>
</div>
</section>
</section>
<section id="configuring-the-predefined-positions">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Configuring the predefined positions</a><a class="headerlink" href="#configuring-the-predefined-positions" title="Permalink to this heading"></a></h2>
<p>An example file “positions.example.h” has been included, however as per “config.h” it is recommended you copy this to your own “positions.h” file and edit to suit, as the example file will be overwritten by future software updates.</p>
<p>Valid position IDs are from 1 to 255 (0 is reserved for “Home”).</p>
<p>When defining the home angle and the various positions, the defined angle is in degrees from the top of the display, or what would be 12 o’clock on an analogue clock.</p>
<p>There are two configuration parameters required as per the table below.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Details and options</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HOME_ANGLE</p></td>
<td><p>0</p></td>
<td><p>The angle at which the homing sensor is located on your actual turntable</p></td>
</tr>
<tr class="row-odd"><td><p>NUMBER_OF_POSITIONS</p></td>
<td><p>10</p></td>
<td><p>The number of predefined positions representing your actual turntable (do not include “Home”)</p></td>
</tr>
</tbody>
</table>
<p>When configuring the predefined positions, the syntax is critical to prevent compiler errors.</p>
<p>Pay close attention to the instructions included in the “positions.example.h” file, which is also included here for reference.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//  NOTE: All angles are expressed in degrees from the top of the display, or in other</span>
<span class="c1">//  words 12 o&#39;clock on an analogue clock.</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="cp">#define HOME_ANGLE 0            </span><span class="c1">// Define the angle in degrees for the home position mark</span>
<span class="cp">#define NUMBER_OF_POSITIONS 10  </span><span class="c1">// Define the number of positions to be defined</span>

<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//  You must define the exact number of positions as defined for NUMBER_OF_POSITIONS.</span>
<span class="c1">//  The syntax must be correct for each line, and there must be no comma &quot;,&quot; at the end</span>
<span class="c1">//  of the last defined position.</span>
<span class="c1">//  The syntax is:</span>
<span class="cm">/*</span>
<span class="cm">positionDefinition turntablePositions[NUMBER_OF_POSITIONS] = {</span>
<span class="cm">  {angle, id, &quot;description&quot;},</span>
<span class="cm">  {angle, id, &quot;description&quot;},</span>
<span class="cm">  ...</span>
<span class="cm">  {angle, id, &quot;description&quot;}</span>
<span class="cm">};</span>
<span class="cm">*/</span>
<span class="c1">//  Where:</span>
<span class="c1">//  angle - Specified in degrees from the top of the display (12 o&#39;clock)</span>
<span class="c1">//  id - The identifier that will be sent to the CommandStation when selected (1 - 255)</span>
<span class="c1">//  &quot;description&quot; - A 10 character or less position description to display when selected</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>

<span class="n">positionDefinition</span><span class="w"> </span><span class="n">turntablePositions</span><span class="p">[</span><span class="n">NUMBER_OF_POSITIONS</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 1&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 2&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 3&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 4&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 5&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 6&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">220</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 7&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 8&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">325</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 9&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="mi">350</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 10&quot;</span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section id="configuring-colours">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Configuring colours</a><a class="headerlink" href="#configuring-colours" title="Permalink to this heading"></a></h2>
<p>An example file “colours.example.h” has been included, however as per “config.h” it is recommended you copy this to your own “colours.h” file and edit to suit, as the example file will be overwritten by future software updates.</p>
<p>Predefined colours are located in “Arduino_GFX.h” (included as part of the Arduino GFX Library), and you can define any colour you choose by specifying the appropriate hex value eg. 0x0000 is black, and 0xFFFF is white.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//  Define colour preferences in this file, refer to &quot;Arduino_GFX.h&quot; for the hex values</span>
<span class="c1">//  of the existing colours defined with the Arduino GFX library.</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//  Define any custom colours here using the appropriate hex value</span>
<span class="c1">// #define MY_COLOUR 0x1234</span>

<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="c1">//  Define the colours to use for each object here</span>
<span class="c1">/////////////////////////////////////////////////////////////////////////////////////</span>
<span class="cp">#define BACKGROUND_COLOUR BLACK           </span><span class="c1">// Background colour for the display</span>
<span class="cp">#define TURNTABLE_COLOUR RED              </span><span class="c1">// Colour of the main turntable body</span>
<span class="cp">#define PIT_COLOUR BLUE                   </span><span class="c1">// Colour of the pit line around the display</span>
<span class="cp">#define TURNTABLE_HOME_COLOUR LIGHTGREY   </span><span class="c1">// Colour of the home end of the turntable</span>
<span class="cp">#define HOME_HIGHLIGHT_COLOUR YELLOW      </span><span class="c1">// Colour of the home end when aligned with a position</span>
<span class="cp">#define HOME_COLOUR CYAN                  </span><span class="c1">// Colour of the home position mark around the pit line</span>
<span class="cp">#define POSITION_COLOUR MAGENTA           </span><span class="c1">// Colour of each position mark around the pit line</span>
<span class="cp">#define POSITION_TEXT_COLOUR GREENYELLOW  </span><span class="c1">// Colour of the position&#39;s text description</span>
</pre></div>
</div>
</section>
</section>

<div class="section">
   
</div>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="control-knob.html" class="btn btn-neutral float-left" title="Control Knob Mode" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ex-rail-integration.html" class="btn btn-neutral float-right" title="Device Driver and EX-RAIL Integration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Peter Cole.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HBTV6STT77"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-HBTV6STT77', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>